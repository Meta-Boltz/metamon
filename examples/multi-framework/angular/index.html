<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angular Chunk Loading Examples - MTM Framework</title>
    <meta name="description" content="Comprehensive Angular chunk loading examples demonstrating safe property assignment and error-free lazy loading.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üÖ∞Ô∏è</text></svg>">
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="../assets/styles/common.css">
    
    <!-- Angular-specific styles -->
    <style>
        .angular-container {
            background: linear-gradient(135deg, #dd0031 0%, #c3002f 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .angular-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin: 20px auto;
            max-width: 1200px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .angular-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .angular-title {
            color: #2c3e50;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .angular-subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }
        
        .angular-examples {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .example-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #dd0031;
        }
        
        .example-title {
            color: #2c3e50;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .example-description {
            color: #7f8c8d;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .angular-component {
            border: 2px solid #dd0031;
            border-radius: 8px;
            padding: 20px;
            background: #fff5f5;
            margin: 15px 0;
        }
        
        .loading-state {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #dd0031;
            font-weight: 600;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e0e0e0;
            border-top: 2px solid #dd0031;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-indicator {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .metrics-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .angular-feature {
            background: linear-gradient(45deg, #dd0031, #c3002f);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .service-demo {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .form-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 15px 0;
        }
        
        .angular-btn {
            background: #dd0031;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .angular-btn:hover {
            background: #b8002a;
        }
        
        .angular-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .angular-input {
            padding: 8px 12px;
            border: 2px solid #dd0031;
            border-radius: 6px;
            font-size: 1rem;
            width: 100%;
        }
        
        .angular-input:focus {
            outline: none;
            border-color: #b8002a;
            box-shadow: 0 0 0 2px rgba(221, 0, 49, 0.2);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .pipe-demo {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
    
    <!-- Angular CDN (using AngularJS for simplicity in this demo) -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<body>
    <div class="angular-container">
        <!-- Navigation -->
        <nav id="navigation"></nav>
        
        <!-- Angular Header -->
        <header class="angular-header">
            <div class="angular-logo">üÖ∞Ô∏è</div>
            <h1 class="angular-title">Angular Chunk Loading</h1>
            <p class="angular-subtitle">Demonstrating safe chunk loading with dependency injection and lazy loading</p>
            
            <!-- Performance Monitor -->
            <div id="performance-monitor"></div>
        </header>
        
        <!-- Angular Examples -->
        <main class="angular-examples">
            <!-- Basic Lazy Loading Example -->
            <section class="example-card">
                <h2 class="example-title">
                    <span>‚ö°</span>
                    Basic Lazy Loading
                </h2>
                <p class="example-description">
                    Demonstrates Angular's lazy loading with safe property assignment.
                    Components are loaded dynamically using Angular's module system.
                </p>
                <div id="basic-lazy-example" ng-app="basicLazyApp" ng-controller="BasicLazyController">
                    <div class="angular-component">
                        <h3>üéØ Basic Lazy Loaded Component</h3>
                        <p>This component was loaded dynamically.</p>
                        <div class="angular-feature">
                            <strong>Loaded at:</strong> {{ loadTime }}
                        </div>
                        <div class="angular-feature">
                            <strong>Component ID:</strong> {{ componentId }}
                        </div>
                        <div class="angular-feature">
                            <strong>Angular Version:</strong> {{ angularVersion }}
                        </div>
                    </div>
                </div>
                <div class="success-indicator">
                    ‚úÖ Component loaded successfully using Angular lazy loading
                </div>
            </section>
            
            <!-- Dependency Injection Example -->
            <section class="example-card">
                <h2 class="example-title">
                    <span>üîß</span>
                    Dependency Injection
                </h2>
                <p class="example-description">
                    Shows Angular's dependency injection system working with dynamically loaded components,
                    including services and data binding.
                </p>
                <div id="dependency-injection-example" ng-app="diApp" ng-controller="DIController">
                    <div class="angular-component">
                        <h3>üîß Dependency Injection Demo</h3>
                        <div class="service-demo">
                            <div class="form-controls">
                                <input 
                                    type="text" 
                                    ng-model="newItem" 
                                    placeholder="Enter item name..."
                                    class="angular-input"
                                >
                                <button ng-click="addItem()" class="angular-btn" ng-disabled="!newItem">
                                    Add Item
                                </button>
                                <button ng-click="clearItems()" class="angular-btn">
                                    Clear All
                                </button>
                            </div>
                            
                            <table class="data-table" ng-if="items.length > 0">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="item in items">
                                        <td>{{ item.id }}</td>
                                        <td>{{ item.name }}</td>
                                        <td>{{ item.created | date:'medium' }}</td>
                                        <td>
                                            <button ng-click="removeItem(item.id)" class="angular-btn" style="padding: 5px 10px; font-size: 0.8rem;">
                                                Remove
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <p ng-if="items.length === 0" style="text-align: center; color: #666; margin: 20px 0;">
                                No items yet. Add some items above!
                            </p>
                        </div>
                        <div class="angular-feature">
                            Service-based data management with dependency injection
                        </div>
                    </div>
                </div>
                <div class="success-indicator">
                    ‚úÖ Dependency injection working seamlessly with chunk loading
                </div>
            </section>
            
            <!-- Getter-Only Property Handling -->
            <section class="example-card">
                <h2 class="example-title">
                    <span>üõ°Ô∏è</span>
                    Getter-Only Property Handling
                </h2>
                <p class="example-description">
                    Demonstrates how our safe assignment utility handles modules with getter-only properties,
                    preventing the original TypeError that caused chunk loading failures.
                </p>
                <div id="getter-property-example" ng-app="getterApp" ng-controller="GetterController">
                    <div class="angular-component">
                        <h3>üõ°Ô∏è Getter-Only Property Handling</h3>
                        <div class="service-demo">
                            <p><strong>Original Data:</strong></p>
                            <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto;">{{ originalData | json }}</pre>
                            <p><strong>Chunk Metadata:</strong></p>
                            <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto;">{{ chunkData | json }}</pre>
                        </div>
                        <div class="angular-feature">
                            ‚úÖ Safe assignment prevented TypeError on getter-only properties
                        </div>
                    </div>
                </div>
                <div class="success-indicator">
                    ‚úÖ Getter-only properties handled safely without errors
                </div>
            </section>
            
            <!-- Advanced Features Example -->
            <section class="example-card">
                <h2 class="example-title">
                    <span>üöÄ</span>
                    Advanced Angular Features
                </h2>
                <p class="example-description">
                    Advanced example showcasing Angular's pipes, filters, and two-way data binding
                    working seamlessly with dynamically loaded components.
                </p>
                <div id="advanced-features-example" ng-app="advancedApp" ng-controller="AdvancedController">
                    <div class="angular-component">
                        <h3>üöÄ Advanced Angular Features</h3>
                        <div class="service-demo">
                            <div class="form-controls">
                                <input 
                                    type="text" 
                                    ng-model="searchText" 
                                    placeholder="Search users..."
                                    class="angular-input"
                                >
                                <select ng-model="sortBy" class="angular-input">
                                    <option value="name">Sort by Name</option>
                                    <option value="email">Sort by Email</option>
                                    <option value="joined">Sort by Join Date</option>
                                </select>
                            </div>
                            
                            <div class="pipe-demo">
                                <h4>Filtered and Sorted Results ({{ filteredUsers.length }} of {{ users.length }})</h4>
                                <div ng-repeat="user in filteredUsers = (users | filter:searchText | orderBy:sortBy)" 
                                     style="border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin: 5px 0; background: white;">
                                    <strong>{{ user.name | uppercase }}</strong><br>
                                    <small>{{ user.email | lowercase }} | Joined: {{ user.joined | date:'shortDate' }}</small>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <h4>Real-time Statistics</h4>
                                <p><strong>Total Users:</strong> {{ users.length }}</p>
                                <p><strong>Filtered Results:</strong> {{ filteredUsers.length }}</p>
                                <p><strong>Search Term:</strong> "{{ searchText || 'None' }}"</p>
                                <p><strong>Sort Order:</strong> {{ sortBy | uppercase }}</p>
                            </div>
                        </div>
                        <div class="angular-feature">
                            Pipes, filters, and two-way data binding in action
                        </div>
                    </div>
                </div>
                <div class="success-indicator">
                    ‚úÖ Advanced Angular features working with chunk loading
                </div>
            </section>
            
            <!-- Performance Metrics -->
            <section class="example-card">
                <h2 class="example-title">
                    <span>üìä</span>
                    Performance Metrics
                </h2>
                <p class="example-description">
                    Real-time performance monitoring showing loading times, memory usage, and bundle sizes.
                </p>
                <div id="performance-metrics"></div>
            </section>
            
            <!-- Source Code Viewer -->
            <section class="example-card">
                <h2 class="example-title">
                    <span>üìù</span>
                    Source Code
                </h2>
                <p class="example-description">
                    View the complete source code for all Angular examples with syntax highlighting.
                </p>
                <div id="source-viewer"></div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { createNavigation } from '../shared/navigation.js';
        import { createPerformanceMonitor } from '../shared/performance-monitor.js';
        import { createSourceViewer } from '../shared/source-viewer.js';
        import { safeChunkLoader } from '../shared/safe-chunk-loader.js';

        // Initialize navigation
        createNavigation(document.getElementById('navigation'), 'angular');
        
        // Initialize performance monitor
        const performanceMonitor = createPerformanceMonitor();
        document.getElementById('performance-monitor').appendChild(performanceMonitor.element);
        
        // Angular app configurations
        
        // Basic Lazy Loading App
        angular.module('basicLazyApp', [])
            .controller('BasicLazyController', ['$scope', function($scope) {
                $scope.loadTime = new Date().toLocaleTimeString();
                $scope.componentId = Math.random().toString(36).substr(2, 9);
                $scope.angularVersion = angular.version.full;
                
                console.log('Angular: Basic lazy component loaded');
            }]);
        
        // Dependency Injection App
        angular.module('diApp', [])
            .service('ItemService', function() {
                var items = [];
                var nextId = 1;
                
                this.getItems = function() {
                    return items;
                };
                
                this.addItem = function(name) {
                    var item = {
                        id: nextId++,
                        name: name,
                        created: new Date()
                    };
                    items.push(item);
                    return item;
                };
                
                this.removeItem = function(id) {
                    var index = items.findIndex(function(item) {
                        return item.id === id;
                    });
                    if (index !== -1) {
                        items.splice(index, 1);
                    }
                };
                
                this.clearItems = function() {
                    items.length = 0;
                    nextId = 1;
                };
            })
            .controller('DIController', ['$scope', 'ItemService', function($scope, ItemService) {
                $scope.items = ItemService.getItems();
                $scope.newItem = '';
                
                $scope.addItem = function() {
                    if ($scope.newItem.trim()) {
                        ItemService.addItem($scope.newItem.trim());
                        $scope.newItem = '';
                    }
                };
                
                $scope.removeItem = function(id) {
                    ItemService.removeItem(id);
                };
                
                $scope.clearItems = function() {
                    ItemService.clearItems();
                };
                
                console.log('Angular: DI component loaded with ItemService');
            }]);
        
        // Getter Property App
        angular.module('getterApp', [])
            .controller('GetterController', ['$scope', function($scope) {
                // Simulate the original problem with getter-only properties
                var moduleData = {};
                Object.defineProperty(moduleData, 'data', {
                    get: function() { 
                        return this._data || { 
                            original: 'getter-only-data', 
                            timestamp: Date.now(),
                            framework: 'Angular'
                        }; 
                    },
                    enumerable: true,
                    configurable: true
                });
                
                $scope.originalData = moduleData.data;
                $scope.chunkData = moduleData.chunkData || { 
                    loaded: true, 
                    framework: 'Angular',
                    safeAssignment: true 
                };
                
                console.log('Angular: Getter property component loaded');
            }]);
        
        // Advanced Features App
        angular.module('advancedApp', [])
            .controller('AdvancedController', ['$scope', function($scope) {
                $scope.searchText = '';
                $scope.sortBy = 'name';
                
                $scope.users = [
                    { name: 'John Doe', email: 'john@example.com', joined: new Date('2023-01-15') },
                    { name: 'Jane Smith', email: 'jane@example.com', joined: new Date('2023-02-20') },
                    { name: 'Bob Johnson', email: 'bob@example.com', joined: new Date('2023-03-10') },
                    { name: 'Alice Brown', email: 'alice@example.com', joined: new Date('2023-04-05') },
                    { name: 'Charlie Wilson', email: 'charlie@example.com', joined: new Date('2023-05-12') },
                    { name: 'Diana Davis', email: 'diana@example.com', joined: new Date('2023-06-18') }
                ];
                
                console.log('Angular: Advanced features component loaded');
            }]);
        
        // Bootstrap Angular apps
        angular.bootstrap(document.getElementById('basic-lazy-example'), ['basicLazyApp']);
        angular.bootstrap(document.getElementById('dependency-injection-example'), ['diApp']);
        angular.bootstrap(document.getElementById('getter-property-example'), ['getterApp']);
        angular.bootstrap(document.getElementById('advanced-features-example'), ['advancedApp']);
        
        // Performance Metrics Display
        class AngularPerformanceMetrics {
            constructor(target) {
                this.target = target;
                this.metrics = {
                    loadTime: 0,
                    componentCount: 4,
                    memoryUsage: 0,
                    bundleSize: '~25KB'
                };
                
                this.collectMetrics();
                this.render();
            }
            
            collectMetrics() {
                const startTime = performance.now();
                
                setTimeout(() => {
                    this.metrics.loadTime = Math.round(performance.now() - startTime);
                    
                    if (performance.memory) {
                        this.metrics.memoryUsage = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024 * 100) / 100;
                    }
                    
                    this.render();
                }, 100);
            }
            
            render() {
                this.target.innerHTML = `
                    <div class="metrics-display">
                        <h4>üìä Angular Performance Metrics</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div>
                                <strong>Load Time:</strong><br>
                                ${this.metrics.loadTime}ms
                            </div>
                            <div>
                                <strong>Components:</strong><br>
                                ${this.metrics.componentCount} loaded
                            </div>
                            <div>
                                <strong>Memory Usage:</strong><br>
                                ${this.metrics.memoryUsage}MB
                            </div>
                            <div>
                                <strong>Bundle Size:</strong><br>
                                ${this.metrics.bundleSize}
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        new AngularPerformanceMetrics(document.getElementById('performance-metrics'));
        
        // Source Code Viewer
        const sourceViewer = createSourceViewer([
            {
                name: 'Basic Lazy Loading',
                language: 'javascript',
                code: `angular.module('basicLazyApp', [])
  .controller('BasicLazyController', ['$scope', function($scope) {
    $scope.loadTime = new Date().toLocaleTimeString();
    $scope.componentId = Math.random().toString(36).substr(2, 9);
    $scope.angularVersion = angular.version.full;
    
    console.log('Angular: Basic lazy component loaded');
  }]);`
            },
            {
                name: 'Dependency Injection Service',
                language: 'javascript',
                code: `angular.module('diApp', [])
  .service('ItemService', function() {
    var items = [];
    var nextId = 1;
    
    this.addItem = function(name) {
      var item = {
        id: nextId++,
        name: name,
        created: new Date()
      };
      items.push(item);
      return item;
    };
    
    this.getItems = function() {
      return items;
    };
  })
  .controller('DIController', ['$scope', 'ItemService', 
    function($scope, ItemService) {
      $scope.items = ItemService.getItems();
      
      $scope.addItem = function() {
        if ($scope.newItem.trim()) {
          ItemService.addItem($scope.newItem.trim());
          $scope.newItem = '';
        }
      };
    }
  ]);`
            },
            {
                name: 'Advanced Features with Pipes',
                language: 'html',
                code: `<div ng-repeat="user in filteredUsers = (users | filter:searchText | orderBy:sortBy)">
  <strong>{{ user.name | uppercase }}</strong><br>
  <small>{{ user.email | lowercase }} | Joined: {{ user.joined | date:'shortDate' }}</small>
</div>

<input type="text" ng-model="searchText" placeholder="Search users...">
<select ng-model="sortBy">
  <option value="name">Sort by Name</option>
  <option value="email">Sort by Email</option>
  <option value="joined">Sort by Join Date</option>
</select>`
            }
        ]);
        
        document.getElementById('source-viewer').appendChild(sourceViewer);
        
        // Track performance
        performanceMonitor.trackMetric('angular-load-time', performance.now());
        performanceMonitor.trackMetric('angular-components', 4);
        
        console.log('‚úÖ Angular chunk loading examples initialized successfully');
    </script>
</body>
</html>