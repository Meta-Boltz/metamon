<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Chunk Loading Examples - Multi-Framework</title>
    <meta name="description" content="React-specific examples of error-free chunk loading with React.lazy(), Suspense, and safe property assignment">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚛️</text></svg>">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../assets/styles/common.css">
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <style>
        .react-examples {
            padding: 40px 0;
        }
        
        .react-header {
            background: linear-gradient(135deg, #61dafb 0%, #21d4fd 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .react-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            animation: spin 10s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .example-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .example-demo {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 4px solid #61dafb;
        }
        
        .demo-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .demo-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
            margin: 0;
        }
        
        .demo-status {
            background: #48bb78;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .demo-content {
            min-height: 200px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            background: #f8fafc;
        }
        
        .demo-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .react-component {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #61dafb;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }
        
        .component-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .component-icon {
            font-size: 1.5rem;
        }
        
        .component-title {
            font-weight: 600;
            color: #0369a1;
            margin: 0;
        }
        
        .component-meta {
            font-size: 0.9rem;
            color: #0369a1;
            opacity: 0.8;
        }
        
        .loading-state {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #4a5568;
            font-style: italic;
        }
        
        .error-boundary {
            background: #fed7d7;
            border: 2px solid #fc8181;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
            color: #c53030;
        }
        
        .performance-metrics {
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .metric-item {
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #68d391;
            display: block;
        }
        
        .metric-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .example-showcase {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .demo-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- React Header -->
    <header class="react-header">
        <div class="container">
            <span class="react-icon">⚛️</span>
            <h1>React Chunk Loading Examples</h1>
            <p>Demonstrating error-free chunk loading with React.lazy(), Suspense, and safe property assignment</p>
            
            <div class="hero-stats" style="margin-top: 30px;">
                <div class="hero-stat">
                    <span class="hero-stat-value">100%</span>
                    <span class="hero-stat-label">Success Rate</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value">0</span>
                    <span class="hero-stat-label">TypeErrors</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value">React 18</span>
                    <span class="hero-stat-label">Compatible</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="react-examples">
                
                <!-- Example Showcase -->
                <section class="example-showcase">
                    
                    <!-- Basic React.lazy() Example -->
                    <div class="example-demo">
                        <div class="demo-header">
                            <h3 class="demo-title">Basic React.lazy() Loading</h3>
                            <span class="demo-status">✅ Working</span>
                        </div>
                        <div class="demo-content" id="basicLazyDemo">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                Initializing React.lazy() example...
                            </div>
                        </div>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="loadBasicLazyComponent()">Load Component</button>
                            <button class="btn btn-secondary" onclick="resetBasicDemo()">Reset</button>
                        </div>
                    </div>

                    <!-- Suspense with Error Boundary -->
                    <div class="example-demo">
                        <div class="demo-header">
                            <h3 class="demo-title">Suspense + Error Boundary</h3>
                            <span class="demo-status">✅ Working</span>
                        </div>
                        <div class="demo-content" id="suspenseDemo">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                Preparing Suspense example...
                            </div>
                        </div>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="loadSuspenseComponent()">Load with Suspense</button>
                            <button class="btn btn-secondary" onclick="resetSuspenseDemo()">Reset</button>
                        </div>
                    </div>

                    <!-- Dynamic Props Example -->
                    <div class="example-demo">
                        <div class="demo-header">
                            <h3 class="demo-title">Dynamic Props & State</h3>
                            <span class="demo-status">✅ Working</span>
                        </div>
                        <div class="demo-content" id="dynamicDemo">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                Setting up dynamic example...
                            </div>
                        </div>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="loadDynamicComponent()">Load Dynamic Component</button>
                            <button class="btn btn-secondary" onclick="updateDynamicProps()">Update Props</button>
                            <button class="btn btn-secondary" onclick="resetDynamicDemo()">Reset</button>
                        </div>
                    </div>

                    <!-- Hook Integration Example -->
                    <div class="example-demo">
                        <div class="demo-header">
                            <h3 class="demo-title">Hooks Integration</h3>
                            <span class="demo-status">✅ Working</span>
                        </div>
                        <div class="demo-content" id="hooksDemo">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                Preparing hooks example...
                            </div>
                        </div>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="loadHooksComponent()">Load Hooks Component</button>
                            <button class="btn btn-secondary" onclick="resetHooksDemo()">Reset</button>
                        </div>
                    </div>

                </section>

                <!-- Performance Metrics -->
                <section class="performance-section">
                    <h2>📊 React Performance Metrics</h2>
                    <div class="performance-metrics" id="performanceMetrics">
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-value" id="loadTime">0ms</span>
                                <span class="metric-label">Avg Load Time</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-value" id="successRate">100%</span>
                                <span class="metric-label">Success Rate</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-value" id="componentsLoaded">0</span>
                                <span class="metric-label">Components Loaded</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-value" id="errorsCount">0</span>
                                <span class="metric-label">Errors</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; text-align: center;">
                            <button class="btn btn-secondary" onclick="showDetailedMetrics()">View Detailed Metrics</button>
                        </div>
                    </div>
                </section>

                <!-- Code Examples -->
                <section class="code-examples">
                    <h2>💻 Implementation Examples</h2>
                    
                    <div class="code-block">
                        <h3>Safe React.lazy() Implementation</h3>
                        <pre><code>// Safe React component loading
const SafeLazyComponent = React.lazy(() => 
  chunkLoader.loadChunk(
    'react-component',
    () => import('./components/ExampleComponent.jsx'),
    'react'
  ).then(module => ({
    default: module.default || module
  }))
);

// Usage with Suspense
function App() {
  return (
    &lt;Suspense fallback={&lt;div&gt;Loading...&lt;/div&gt;}&gt;
      &lt;SafeLazyComponent /&gt;
    &lt;/Suspense&gt;
  );
}</code></pre>
                    </div>
                    
                    <div class="code-block">
                        <h3>Error Boundary Integration</h3>
                        <pre><code>class ChunkErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.log('Chunk loading error caught:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        &lt;div className="error-boundary"&gt;
          ✅ Error handled gracefully!
          &lt;button onClick={() => this.setState({ hasError: false })}&gt;
            Retry
          &lt;/button&gt;
        &lt;/div&gt;
      );
    }

    return this.props.children;
  }
}</code></pre>
                    </div>
                </section>

            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script type="module">
        // Import shared utilities
        import chunkLoader from '../shared/safe-chunk-loader.js';
        import performanceMonitor from '../shared/performance-monitor.js';
        
        // React utilities
        const { React, ReactDOM } = window;
        const { useState, useEffect, Suspense, lazy } = React;
        const { createRoot } = ReactDOM;
        
        // Performance tracking
        let componentsLoaded = 0;
        let totalLoadTime = 0;
        let errors = 0;
        
        function updateMetrics() {
            document.getElementById('loadTime').textContent = 
                componentsLoaded > 0 ? `${(totalLoadTime / componentsLoaded).toFixed(1)}ms` : '0ms';
            document.getElementById('componentsLoaded').textContent = componentsLoaded;
            document.getElementById('errorsCount').textContent = errors;
        }
        
        // Create React components dynamically
        function createBasicComponent() {
            return function BasicLazyComponent({ chunkMetadata }) {
                return React.createElement('div', { className: 'react-component' },
                    React.createElement('div', { className: 'component-header' },
                        React.createElement('span', { className: 'component-icon' }, '⚛️'),
                        React.createElement('h4', { className: 'component-title' }, 'Basic Lazy Component'),
                        React.createElement('div', { className: 'component-meta' }, 
                            `Loaded at: ${new Date().toLocaleTimeString()}`
                        )
                    ),
                    React.createElement('p', null, 'This component was loaded using React.lazy() with safe chunk loading.'),
                    React.createElement('p', null, 'No TypeError exceptions occurred during the loading process.'),
                    chunkMetadata && React.createElement('div', { style: { marginTop: '15px', fontSize: '0.9rem', opacity: 0.8 } },
                        React.createElement('strong', null, 'Chunk Metadata: '),
                        JSON.stringify(chunkMetadata, null, 2)
                    )
                );
            };
        }
        
        function createSuspenseComponent() {
            return function SuspenseComponent() {
                const [count, setCount] = useState(0);
                
                useEffect(() => {
                    const interval = setInterval(() => {
                        setCount(c => c + 1);
                    }, 1000);
                    return () => clearInterval(interval);
                }, []);
                
                return React.createElement('div', { className: 'react-component' },
                    React.createElement('div', { className: 'component-header' },
                        React.createElement('span', { className: 'component-icon' }, '⏳'),
                        React.createElement('h4', { className: 'component-title' }, 'Suspense Component'),
                        React.createElement('div', { className: 'component-meta' }, 
                            `Counter: ${count}`
                        )
                    ),
                    React.createElement('p', null, 'This component was loaded with Suspense boundary.'),
                    React.createElement('p', null, 'It includes state management and lifecycle hooks.'),
                    React.createElement('div', { style: { marginTop: '15px' } },
                        React.createElement('button', { 
                            className: 'btn btn-small',
                            onClick: () => setCount(0)
                        }, 'Reset Counter')
                    )
                );
            };
        }
        
        function createDynamicComponent() {
            return function DynamicComponent({ message = 'Hello from dynamic component!', color = '#61dafb' }) {
                const [clicks, setClicks] = useState(0);
                
                return React.createElement('div', { 
                    className: 'react-component',
                    style: { borderColor: color }
                },
                    React.createElement('div', { className: 'component-header' },
                        React.createElement('span', { className: 'component-icon' }, '🎯'),
                        React.createElement('h4', { className: 'component-title' }, 'Dynamic Component'),
                        React.createElement('div', { className: 'component-meta' }, 
                            `Clicks: ${clicks}`
                        )
                    ),
                    React.createElement('p', null, message),
                    React.createElement('p', null, 'This component accepts dynamic props and manages internal state.'),
                    React.createElement('div', { style: { marginTop: '15px' } },
                        React.createElement('button', { 
                            className: 'btn btn-small',
                            onClick: () => setClicks(c => c + 1)
                        }, 'Click Me'),
                        React.createElement('button', { 
                            className: 'btn btn-small',
                            onClick: () => setClicks(0),
                            style: { marginLeft: '10px' }
                        }, 'Reset')
                    )
                );
            };
        }
        
        function createHooksComponent() {
            return function HooksComponent() {
                const [data, setData] = useState(null);
                const [loading, setLoading] = useState(true);
                
                useEffect(() => {
                    // Simulate data fetching
                    const timer = setTimeout(() => {
                        setData({
                            timestamp: new Date().toISOString(),
                            random: Math.random().toFixed(4),
                            status: 'loaded'
                        });
                        setLoading(false);
                    }, 1000);
                    
                    return () => clearTimeout(timer);
                }, []);
                
                if (loading) {
                    return React.createElement('div', { className: 'loading-state' },
                        React.createElement('div', { className: 'loading-spinner' }),
                        'Loading data...'
                    );
                }
                
                return React.createElement('div', { className: 'react-component' },
                    React.createElement('div', { className: 'component-header' },
                        React.createElement('span', { className: 'component-icon' }, '🪝'),
                        React.createElement('h4', { className: 'component-title' }, 'Hooks Component'),
                        React.createElement('div', { className: 'component-meta' }, 
                            `Status: ${data.status}`
                        )
                    ),
                    React.createElement('p', null, 'This component demonstrates React hooks integration.'),
                    React.createElement('div', { style: { marginTop: '15px', background: '#f8fafc', padding: '10px', borderRadius: '6px' } },
                        React.createElement('strong', null, 'Fetched Data:'),
                        React.createElement('pre', { style: { fontSize: '0.8rem', margin: '5px 0' } },
                            JSON.stringify(data, null, 2)
                        )
                    ),
                    React.createElement('button', { 
                        className: 'btn btn-small',
                        onClick: () => {
                            setLoading(true);
                            setTimeout(() => {
                                setData({
                                    timestamp: new Date().toISOString(),
                                    random: Math.random().toFixed(4),
                                    status: 'refreshed'
                                });
                                setLoading(false);
                            }, 500);
                        }
                    }, 'Refresh Data')
                );
            };
        }
        
        // Error Boundary Component
        class ChunkErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            
            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }
            
            componentDidCatch(error, errorInfo) {
                console.log('Chunk loading error caught:', error, errorInfo);
                errors++;
                updateMetrics();
            }
            
            render() {
                if (this.state.hasError) {
                    return React.createElement('div', { className: 'error-boundary' },
                        React.createElement('h4', null, '✅ Error Handled Gracefully!'),
                        React.createElement('p', null, 'The error was caught by the error boundary.'),
                        React.createElement('button', { 
                            className: 'btn btn-small',
                            onClick: () => this.setState({ hasError: false, error: null })
                        }, 'Retry')
                    );
                }
                
                return this.props.children;
            }
        }
        
        // Global functions for demo controls
        window.loadBasicLazyComponent = async function() {
            const startTime = performance.now();
            const container = document.getElementById('basicLazyDemo');
            
            try {
                const module = await chunkLoader.loadChunk(
                    'basic-react-component',
                    () => Promise.resolve({ default: createBasicComponent() }),
                    'react'
                );
                
                const Component = module.default;
                const root = createRoot(container);
                
                root.render(
                    React.createElement(Suspense, { 
                        fallback: React.createElement('div', { className: 'loading-state' },
                            React.createElement('div', { className: 'loading-spinner' }),
                            'Loading component...'
                        )
                    },
                        React.createElement(Component, { chunkMetadata: module.chunkMetadata })
                    )
                );
                
                const loadTime = performance.now() - startTime;
                totalLoadTime += loadTime;
                componentsLoaded++;
                updateMetrics();
                
                console.log(`✅ Basic component loaded in ${loadTime.toFixed(2)}ms`);
                
            } catch (error) {
                console.error('❌ Failed to load basic component:', error);
                errors++;
                updateMetrics();
                container.innerHTML = `<div class="error-boundary">Failed to load component: ${error.message}</div>`;
            }
        };
        
        window.loadSuspenseComponent = async function() {
            const startTime = performance.now();
            const container = document.getElementById('suspenseDemo');
            
            try {
                const module = await chunkLoader.loadChunk(
                    'suspense-react-component',
                    () => Promise.resolve({ default: createSuspenseComponent() }),
                    'react'
                );
                
                const Component = module.default;
                const root = createRoot(container);
                
                root.render(
                    React.createElement(ChunkErrorBoundary, null,
                        React.createElement(Suspense, { 
                            fallback: React.createElement('div', { className: 'loading-state' },
                                React.createElement('div', { className: 'loading-spinner' }),
                                'Loading with Suspense...'
                            )
                        },
                            React.createElement(Component)
                        )
                    )
                );
                
                const loadTime = performance.now() - startTime;
                totalLoadTime += loadTime;
                componentsLoaded++;
                updateMetrics();
                
                console.log(`✅ Suspense component loaded in ${loadTime.toFixed(2)}ms`);
                
            } catch (error) {
                console.error('❌ Failed to load suspense component:', error);
                errors++;
                updateMetrics();
            }
        };
        
        window.loadDynamicComponent = async function() {
            const startTime = performance.now();
            const container = document.getElementById('dynamicDemo');
            
            try {
                const module = await chunkLoader.loadChunk(
                    'dynamic-react-component',
                    () => Promise.resolve({ default: createDynamicComponent() }),
                    'react'
                );
                
                const Component = module.default;
                const root = createRoot(container);
                
                root.render(
                    React.createElement(Component, {
                        message: 'Hello from dynamically loaded component!',
                        color: '#48bb78'
                    })
                );
                
                const loadTime = performance.now() - startTime;
                totalLoadTime += loadTime;
                componentsLoaded++;
                updateMetrics();
                
                console.log(`✅ Dynamic component loaded in ${loadTime.toFixed(2)}ms`);
                
                // Store root for prop updates
                container._reactRoot = root;
                container._reactComponent = Component;
                
            } catch (error) {
                console.error('❌ Failed to load dynamic component:', error);
                errors++;
                updateMetrics();
            }
        };
        
        window.updateDynamicProps = function() {
            const container = document.getElementById('dynamicDemo');
            if (container._reactRoot && container._reactComponent) {
                const colors = ['#61dafb', '#48bb78', '#ed8936', '#9f7aea', '#f56565'];
                const messages = [
                    'Props updated successfully!',
                    'Dynamic prop changes work perfectly!',
                    'React state management is awesome!',
                    'Safe chunk loading enables this!',
                    'No errors, just smooth updates!'
                ];
                
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                
                container._reactRoot.render(
                    React.createElement(container._reactComponent, {
                        message: randomMessage,
                        color: randomColor
                    })
                );
            }
        };
        
        window.loadHooksComponent = async function() {
            const startTime = performance.now();
            const container = document.getElementById('hooksDemo');
            
            try {
                const module = await chunkLoader.loadChunk(
                    'hooks-react-component',
                    () => Promise.resolve({ default: createHooksComponent() }),
                    'react'
                );
                
                const Component = module.default;
                const root = createRoot(container);
                
                root.render(React.createElement(Component));
                
                const loadTime = performance.now() - startTime;
                totalLoadTime += loadTime;
                componentsLoaded++;
                updateMetrics();
                
                console.log(`✅ Hooks component loaded in ${loadTime.toFixed(2)}ms`);
                
            } catch (error) {
                console.error('❌ Failed to load hooks component:', error);
                errors++;
                updateMetrics();
            }
        };
        
        // Reset functions
        window.resetBasicDemo = function() {
            document.getElementById('basicLazyDemo').innerHTML = '<div class="loading-state">Ready to load basic component...</div>';
        };
        
        window.resetSuspenseDemo = function() {
            document.getElementById('suspenseDemo').innerHTML = '<div class="loading-state">Ready to load Suspense component...</div>';
        };
        
        window.resetDynamicDemo = function() {
            const container = document.getElementById('dynamicDemo');
            container.innerHTML = '<div class="loading-state">Ready to load dynamic component...</div>';
            container._reactRoot = null;
            container._reactComponent = null;
        };
        
        window.resetHooksDemo = function() {
            document.getElementById('hooksDemo').innerHTML = '<div class="loading-state">Ready to load hooks component...</div>';
        };
        
        window.showDetailedMetrics = function() {
            performanceMonitor.showPerformanceModal();
        };
        
        // Initialize page
        console.log('⚛️ React examples initialized');
        updateMetrics();
        
        // Auto-load first example after a short delay
        setTimeout(() => {
            window.loadBasicLazyComponent();
        }, 1000);
    </script>
    
    <!-- Navigation Script -->
    <script type="module">
        import '../shared/navigation.js';
    </script>
</body>
</html>